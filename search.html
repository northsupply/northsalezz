<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YYC Sales Shop - Search</title>
<style>
@font-face {
  font-family: 'Dogica';
  src: url('./Resources/Fonts/dogica.ttf') format('truetype');
}
body {
  margin: 0;
  font-family: 'Dogica', sans-serif;
  background-color: #fff;
  color: #000;
  scroll-behavior: smooth;
}
.navbar {
  position: sticky;
  top: 0;
  width: 100%;
  background-color: #fff;
  border-bottom: 1px solid #000;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 24px;
  z-index: 10;
}
.nav-left, .nav-right { display: flex; align-items: center; gap: 24px; }
.nav-left a { text-decoration: none; color: #000; font-weight: bold; cursor: pointer; }
.nav-right button {
  background-color: #000;
  color: #fff;
  border: 2px solid transparent;
  padding: 10px 18px;
  cursor: pointer;
  font-weight: bold;
}
section { padding: 24px; }
h2 { text-align: center; font-size: 24px; margin: 16px 0; font-weight: bold; line-height:1.25; }
#search-container { text-align: center; margin-bottom: 20px; }
#search-input { padding: 10px; width: 90%; max-width: 500px; font-size:16px; border:2px solid #000; }
#search-results { display: grid; grid-template-columns: repeat(auto-fill,minmax(250px,1fr)); gap: 3px; border-top:3px solid #000; border-left:3px solid #000; }
.product { border-right:3px solid #000; border-bottom:3px solid #000; display:flex; flex-direction:column; align-items:center; justify-content:flex-end; text-align:center; overflow:hidden; cursor:pointer; transition: transform 0.1s; }
.product:hover { transform:scale(1.02); }
.product img { width:100%; object-fit:contain; }
.product-info { width:100%; display:flex; flex-direction:column; justify-content:center; background-color:#fff; border-top:1px solid #000; line-height:1.25; }
.product-info h3, .product-info p { margin:4px 0; }
.old-price { text-decoration: line-through; color:red; margin-right:8px; }
.new-price { color:red; font-weight:700; }
</style>
</head>
<body>
<div class="navbar">
  <div class="nav-left">
    <a href="index.html">HOME</a>
  </div>
</div>

<section id="search-page">
  <div id="search-container">
    <input type="text" id="search-input" placeholder="Search products...">
  </div>
  <div id="search-results"></div>
</section>

<script>
let productsData = null;

// Load products
async function loadProducts() {
  const response = await fetch('./products.json');
  const data = await response.json();
  productsData = data;
  renderSearchResults('');
}

// Render search results
function renderSearchResults(query) {
  const resultsContainer = document.getElementById('search-results');
  resultsContainer.innerHTML = '';

  const filtered = productsData.products.filter(p => {
    const q = query.toLowerCase();
    return (
      p.title.toLowerCase().includes(q) ||
      (p.description && p.description.toLowerCase().includes(q)) ||
      (p.categories && p.categories.some(c => c.toLowerCase().includes(q))) ||
      (p.tags && p.tags.some(t => t.toLowerCase().includes(q))) ||
      (p.price && p.price.toString().toLowerCase().includes(q)) ||
      (p.price_sale && p.price_sale.toString().toLowerCase().includes(q)) ||
      (p.price_original && p.price_original.toString().toLowerCase().includes(q))
    );
  });

  filtered.forEach(p => {
    const el = document.createElement('div');
    el.className = 'product';

    let priceHTML = '';
    if (p.price_sale && p.price_original) {
      priceHTML = `<p><span class="old-price">${p.price_original}</span> <span class="new-price">${p.price_sale}</span></p>`;
    } else {
      priceHTML = `<p>${p.price || p.price_original || ''}</p>`;
    }

    el.innerHTML = `
      <img src="${p.thumbnail || './Resources/default.webp'}" alt="${p.title}">
      <div class="product-info">
        <h3>${p.title}</h3>
        ${priceHTML}
      </div>
    `;

    // Dynamic image resizing based on title lines
    const img = el.querySelector('img');
    const title = el.querySelector('h3');
    setTimeout(() => {
      const lineHeight = parseFloat(window.getComputedStyle(title).lineHeight);
      const lines = Math.ceil(title.scrollHeight / lineHeight);
      let imgHeight = 75;
      if (lines === 3) imgHeight = 65;
      else if (lines > 3) imgHeight = 65 - (lines - 3) * 10;
      if (imgHeight < 30) imgHeight = 30;
      img.style.height = imgHeight + '%';
    },50);

    // Open product page in main index.html
    el.onclick = () => {
      // Pass product title as query parameter
      const mainUrl = 'index.html';
      const url = `${mainUrl}?product=${encodeURIComponent(p.title)}`;
      window.location.href = url;
    };


    resultsContainer.appendChild(el);
  });
}

// Search input event
document.getElementById('search-input').addEventListener('input', e => {
  renderSearchResults(e.target.value);
});

window.addEventListener('load', loadProducts);
</script>
</body>
</html>
