<!DOCTYPE html>
<html lang="en">
<head>

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<style>
  /* Force horizontal scaling to 100% */
  html, body {
    width: 100%;
    overflow-x: hidden; /* Prevent horizontal scrollbars */
    box-sizing: border-box; /* Ensure elements respect width */
  }

  *, *::before, *::after {
    box-sizing: inherit; /* Apply box-sizing to all elements */
  }
</style>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NorthSalezz</title>
<style>
@font-face {
  font-family: 'Dogica';
  src: url('./Resources/Fonts/dogica.ttf') format('truetype');
}
body {
  margin: 0;
  font-family: 'Dogica', sans-serif;
  background-color: #fff;
  color: #000;
  scroll-behavior: smooth;
}
.navbar {
  position: sticky;
  top: 0;
  width: 100%;
  background-color: #fff;
  border-bottom: 1px solid #000;
  display: flex;
  flex-wrap: wrap;
  row-gap: 10px;
  justify-content: space-between;
  align-items: center;
  padding: 12px 24px;
  z-index: 10;
}
.nav-left, .nav-right { display: flex; align-items: center; gap: 24px; }
.nav-left a { text-decoration: none; color: #000; font-weight: bold; cursor: pointer; }
.nav-right button {
  background-color: #000;
  color: #fff;
  border: 2px solid transparent;
  padding: 10px 18px;
  cursor: pointer;
  font-weight: bold;
}
section { padding: 24px; display: none; }
section.active { display: block; }
h2 { text-align: center; font-size: 24px; margin: 16px 0; font-weight: bold; line-height:1.25; }

#sale { width:100%; display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:3px; border-top:3px solid #000; border-left:3px solid #000; }
.product { border-right:3px solid #000; border-bottom:3px solid #000; display:flex; flex-direction:column; align-items:center; justify-content:flex-end; text-align:center; overflow:hidden; cursor:pointer; transition: transform 0.1s; }
.product:hover { transform:scale(1.02); }
.product img { width:100%; object-fit:contain; }
.product-info { width:100%; display:flex; flex-direction:column; justify-content:center; background-color:#fff; border-top:1px solid #000; line-height:1.25; }
.product-info h3, .product-info p { margin:4px 0; }

.old-price { text-decoration: line-through; color:red; margin-right:8px; }
.new-price { color:red; font-weight:700; }

#category-buttons { display:grid; grid-template-columns:1fr; gap:8px; margin-top:12px; }
.category-btn { letter-spacing:5px; padding:10px; border:2px solid #000; background-color:#fff; cursor:pointer; text-align:center; font-weight:bold; }
.category-btn:hover { background-color:#f2f2f2; }
.category-header { text-align:center; font-size:24px; margin-bottom:16px; font-weight:bold; line-height:1.25; letter-spacing:5px;}
.category-grid { width:100%; display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:3px; border-top:3px solid #000; border-left:3px solid #000; }

#product-page h1 { text-align:center; font-size:28px; margin-top:10px; line-height:1.25; }
#product-page h2 { text-align:center; font-size:24px; margin:10px 0; line-height:1.25; }
#product-page img { display:block; margin:0 auto; max-width:90%; height:auto; border:3px solid #000; border-radius:6px; }
#product-code { font-family: Arial, sans-serif; font-size:40px; font-weight:bold; text-align:center; margin:10px 0; }
#how-to-order { text-align:center; font-size:14px; color:#0000ee; text-decoration:underline; cursor:pointer; }
#back-btn { display:block; margin:20px auto; border:2px solid #000; background-color:#fff; padding:10px 16px; cursor:pointer; font-weight:bold; }

#landing-column {
  width: 100%;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  height: auto;
  margin-bottom: 5px;
  min-margin-bottom: 5px;
  min-padding: 5px;
  padding: 5px;
  border-bottom: 3px solid #000;
  padding-bottom: 10px;
}

#landing-section {
  width: 100%;
  display: flex;
  max-width: 1200px;
  height: 400px;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  min-height: 150px;
  margin-bottom: 1;
}

#landing-text {
  flex: 1;
  padding: 12px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  text-wrap: pretty;
  overflow: hidden;
}

#landing-title {
  font-size: clamp(14px, 36px, 40px);
  font-weight: bold;
  line-height: 1.2;
  margin-bottom: 8px;
  word-wrap: break-word;
}

#landing-description {
  margin-top: 1px;
  font-size: clamp(14px, 18px, 20px);
  line-height: 1.25em;
  word-wrap: break-word;
  margin-bottom: 5px;
}

#landing-img-container {
  flex: 0 0 auto;
  height: 75%;
  max-width: 35%;
  width: 35%;
  min-width: 35%;
  overflow: hidden;
  margin-bottom: 5px;
  justify-content: center;
  object-fit: contain;
}

#landing-img-container img {
  height: 100%;
  width: 100%;
  max-height: 100%;
  object-fit: contain;
}

</style>
</head>
<body>
  <div class="navbar">
     <div class="nav-left">
       <a data-page="main">HOME</a>
       <a href="#sale-section">SALE</a>
       <a href="#categories-section">CATEGORIES</a>
       <a data-page="services">SERVICES</a>
       <a href="search.html">SEARCH</a>
   </div>
  <div class="nav-right">
    <button data-page="howtobuy">HOW TO BUY</button>
  </div>
</div>

<section id="main" class="active">
  <section id="landing-column">
    <div id="landing-section">
      <div id="landing-img-container">
        <img id="landing-img" src="" alt="Featured Product">
      </div>
      <div id="landing-text">
        <h1 id="landing-title">NORTHSALEZZ STORE</h1>
        <p id="landing-description">
          This is the landing page of my shop/menu for my products. Prices listed here are mostly negotiable so feel free to ask me.
        </p>
      </div>
    </div>
  </section>



  <div id="sale-section">
    <h2>Sale</h2>
    <div id="sale"></div>
  </div>

  <div id="categories-section">
    <h2>Categories</h2>
    <div id="category-buttons"></div>
  </div>
</section>

<section id="category-page"></section>
<section id="product-page"></section>

<section id="services">
  <h2>Services</h2>
  <script async src="https://telegram.org/js/telegram-widget.js?22" data-telegram-post="northsalezz/10" data-width="100%" data-color="343638" data-dark-color="FFFFFF"></script>
</section>

<section id="howtobuy">
  <h2>How to Buy</h2>
  <script async src="https://telegram.org/js/telegram-widget.js?22" data-telegram-post="northsalezz/11" data-width="100%"></script>
  <img src="./Resources/orderscreenshot1.webp" alt="orderscreenshot1.webp" width="1000" height="500">
</section>

<script>
let productsData = null;

// --- Render Functions ---
function renderSale(data) {
  const saleGrid = document.getElementById('sale');
  const saleProducts = data.products.filter(p =>
    p.tags.map(t => t.toLowerCase()).includes('sale')
  );
  if (saleProducts.length === 0) {
    document.getElementById('sale-section').style.display = 'none';
    return;
  }
  saleProducts.forEach(p => saleGrid.appendChild(createProductElement(p)));
}

function renderCategoryButtons(data) {
  const container = document.getElementById('category-buttons');
  container.innerHTML = '';
  
  // Add "All" button first
  const allBtn = document.createElement('div');
  allBtn.className = 'category-btn';
  allBtn.textContent = 'All';
  allBtn.onclick = () => showCategory('All');
  container.appendChild(allBtn);

  data.database.categories.forEach(cat => {
    const btn = document.createElement('div');
    btn.className = 'category-btn';
    btn.textContent = cat;
    btn.onclick = () => showCategory(cat);
    container.appendChild(btn);
  });
}

// --- Product Element ---
function createProductElement(p) {
  const el = document.createElement('div');
  el.className = 'product';

  let priceHTML = '';
  if (p.price_sale && p.price_original) {
    priceHTML = `<p><span class="old-price">${p.price_original}</span> <span class="new-price">${p.price_sale}</span></p>`;
  } else {
    priceHTML = `<p>${p.price || p.price_original || ''}</p>`;
  }

  el.innerHTML = `
    <img src="${p.thumbnail || './Resources/default.webp'}" alt="${p.title}">
    <div class="product-info">
      <h3>${p.title}</h3>
      ${priceHTML}
    </div>
  `;
  el.onclick = () => showProduct(p.title);

  // Dynamic image resizing based on text lines
  const img = el.querySelector('img');
  const title = el.querySelector('h3');
  setTimeout(() => {
    const lineHeight = parseFloat(window.getComputedStyle(title).lineHeight);
    const lines = Math.ceil(title.scrollHeight / lineHeight);
    let imgHeight = 75;
    if (lines === 3) imgHeight = 65;
    else if (lines > 3) imgHeight = 65 - (lines - 3) * 10;
    if (imgHeight < 30) imgHeight = 30;
    img.style.height = imgHeight + '%';
  }, 50);

  return el;
}

// --- Section Navigation ---
function showSection(sectionId, scrollToId=null, skipPush=false) {
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  const section = document.getElementById(sectionId);
  if (!section) return;
  section.classList.add('active');
  if (scrollToId) {
    const el = document.getElementById(scrollToId);
    if (el) el.scrollIntoView({behavior:'smooth'});
  }
  if (!skipPush) history.pushState({section:sectionId, scrollTo:scrollToId}, '', '');
}

// --- Product Page ---
function showProduct(title, skipPush=false) {
  const product = productsData.products.find(p => p.title === title);
  if (!product) return;

  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  const productPage = document.getElementById('product-page');
  productPage.classList.add('active');

  const priceDisplay = product.price_sale
    ? `<span class="old-price">${product.price_original}</span> <span class="new-price">${product.price_sale}</span>`
    : `${product.price || product.price_original || ''}`;

  productPage.innerHTML = `
    <button id="back-btn">‚Üê Back</button>
    <h1>${product.title}</h1>
    <h2>${priceDisplay}</h2>
    <div id="product-code">Product Code: ${product.code}</div>
    <div id="how-to-order" onclick="showSection('howtobuy')">How to order?</div>
    <img src="${product.thumbnail || './Resources/default.webp'}" alt="${product.title}">
  `;
  document.getElementById('back-btn').addEventListener('click', ()=>history.back());
  if (!skipPush) history.pushState({section:'product-page', productTitle:title}, '', '');
}

// --- Category Page ---
function showCategory(catName, skipPush=false) {
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  const catPage = document.getElementById('category-page');
  catPage.classList.add('active');

  let catProducts;
  if (catName === 'All') {
    catProducts = productsData.products; // all products
  } else {
    catProducts = productsData.products.filter(p =>
      p.categories.map(c => c.toLowerCase()).includes(catName.toLowerCase())
    );
  }


  catPage.innerHTML = `
    <div class="category-header">${catName}</div>
    <div class="category-grid" id="cat-grid"></div>
  `;
  const grid = document.getElementById('cat-grid');
  catProducts.forEach(p => grid.appendChild(createProductElement(p)));
  if (!skipPush) history.pushState({section:'category-page', category:catName}, '', '');
  
 
}


// --- Landing Image Cycle ---
function startLandingImageCycle() {
  if (!productsData) return;
  const landingImg = document.getElementById('landing-img');
  const thumbnails = productsData.products.filter(p=>p.thumbnail).map(p=>p.thumbnail);
  if (thumbnails.length===0) return;
  landingImg.src = thumbnails[0];
  setInterval(() => {
    const index = Math.floor(Math.random()*thumbnails.length);
    landingImg.src = thumbnails[index];
  }, 5000);
}

// --- Load Products ---
async function loadProducts() {
  const response = await fetch('./products.json');
  const data = await response.json();
  productsData = data;
  renderSale(data);
  renderCategoryButtons(data);
  startLandingImageCycle();
}

// --- History/Popstate ---
window.addEventListener('popstate', e => {
  if (e.state) {
    if (e.state.section==='product-page' && e.state.productTitle) showProduct(e.state.productTitle,true);
    else if (e.state.section==='category-page' && e.state.category) showCategory(e.state.category,true);
    else showSection(e.state.section, e.state.scrollTo, true);
  } else showSection('main', null, true);
});

// --- Navbar Clicks ---
document.querySelectorAll('[data-page]').forEach(link => {
  link.addEventListener('click', e => {
    const page = e.target.getAttribute('data-page');
    showSection(page);
  });
});
document.querySelectorAll('a[href^="#"]').forEach(link => {
  link.addEventListener('click', e => {
    e.preventDefault();
    const targetId = link.getAttribute('href').substring(1);
    if (!document.getElementById('main').classList.contains('active')) showSection('main', targetId);
    else {
      const targetEl = document.getElementById(targetId);
      if (targetEl) targetEl.scrollIntoView({behavior:'smooth'});
      history.pushState({section:'main', scrollTo:targetId}, '', '');
    }
  });
});

window.addEventListener('load', ()=>{ if(!history.state) showSection('main', null, true); });

loadProducts();

// On page load, check if URL has a product query parameter
window.addEventListener('load', () => {
  const params = new URLSearchParams(window.location.search);
  const productTitle = params.get('product');
  if (productTitle && productsData) {
    const product = productsData.products.find(p => p.title === productTitle);
    if (product) {
      // If product has a category, show category page first
      const cat = product.categories && product.categories[0];
      if (cat) {
        showCategory(cat, true); // skipPush true so browser history is correct
        setTimeout(() => showProduct(productTitle, true), 100); // open product after category
      } else {
        showProduct(productTitle, true);
      }
    }
  }
});

function adjustLandingFont() {
  const title = document.getElementById('landing-title');
  const description = document.getElementById('landing-description');
  const container = document.getElementById('landing-text');

  [title, description].forEach(el => {
    let fontSize = parseInt(window.getComputedStyle(el).fontSize);
    el.style.whiteSpace = 'normal';
    while (el.scrollWidth > container.clientWidth && fontSize > 10) {
      fontSize -= 1;
      el.style.fontSize = fontSize + 'px';
    }
  });
}

window.addEventListener('load', adjustLandingFont);
window.addEventListener('resize', adjustLandingFont);

</script>

<p style="text-align: center; font-size: 18px;">FEEDBACK</p>
<div id="ff-compose"></div>
<script async defer src="https://formfacade.com/include/108140097648721910587/form/1FAIpQLSd9SdPebDEZcnE_zabTOcUQOIkoxrVZc4n1BqNKIXJw05CA7Q/classic.js?div=ff-compose"></script>

</body>
</html>
